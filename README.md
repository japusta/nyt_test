# NYT Test — лента новостей на React + RTK Query

Проект показывает ленту материалов New York Times двумя способами:

1) Классический скролл без виртуализации (основная ветка).
2. Виртуализированный скролл (в отдельной ветке).

   Что умеет приложение

### Два режима фида:

1. Archive — подгрузка материалов по месяцам из NYT Archive API (история).

2. TimesWire — свежие публикации с пагинацией по offset из TimesWire API.

    Автоподгрузка при прокрутке (infinite scroll).

    Обновление даты в шапке в зависимости от текущей видимой секции.

    Троттлинг/бэкофф запросов (защита от ошибки 429).

### Запуск

```bash
git clone https://github.com/japusta/nyt_test.git
cd nyt_test
```

```bash
npm install
```

Создайте .env и укажите ключ NYT:

```bash
VITE_NYT_API_KEY=ваш_nyt_api_key
```

>Ключ берётся с https://developer.nytimes.com/
 (нужны права на Archive API и TimesWire API).
> Я использовал ключ oB0U5qaFGgKOeDAUAPaS7drPAwwYUDnu

запуск сервера

```bash
npm run dev
```

### Архитектура
Технологии

* React 18

* Redux Toolkit + RTK Query

* TypeScript

* date-fns, clsx

* Виртуализация (в соответствующей ветке): react-virtuoso

Основные директории/файлы


Название файла  | Содержание файла
----------------|----------------------
src/app/store.ts       | конфигурация Redux
src/features/news/newsSlice.ts       | нормализованное хранилище статей, селекторы секций, режимы фида
src/features/news/nytApi.ts   | RTK Query endpoints: Archive и TimesWire
src/components/Header.tsx       | верхняя панель, дата, меню выбора режима/категории
src/components/Section.tsx    | секция дня с карточками (без виртуализации)
src/components/Card.tsx | карточка новости
src/components/Loader.tsx      | Элемент лоадера
src/components/Footer.tsx    | Футер
src/App.tsx      | загрузка, бесконечный скролл, переключение режимов.


### Возможные проблемы

Archive API иногда возвращает пустые месяцы — это нормально, приложение ищет следующий непустой назад.

При плохой сети возможны дублирующиеся срабатывания IntersectionObserver — троттлинг это прикрывает.

### классическая версия, без виртуализации

* ***Режим Archive***

При первом входе приложение ищет последний непустой месяц в архиве (идёт назад от текущего).

Состояние:

cursor: Date — указывает, какой месяц показан последним.

loadedMonths: Set<string> — чтобы не запрашивать один месяц дважды.

Бесконечная подгрузка:

На странице есть sentinel (невидимый div внизу).

IntersectionObserver срабатывает при приближении — грузим предыдущий месяц (prevMonth(cursor)).

* ***Режим TimesWire***

Первая страница + polling каждые 30 сек.

Пагинация — по ```offset = 0, 20, 40, …```.

Догрузка при достижении sentinel.

### виртуализированная версия, ветка с react-virtuoso

* ```GroupedVirtuoso``` с ```useWindowScroll``` — виртуализация групп (дней) и элементов внутри группы.

* ```groupCounts``` — массив с количеством карточек на день.

* ```groupContent``` — рендер заголовка группы (дата).

* ```itemContent``` — рендер карточки; защитные проверки от overscan.

* ```endReached``` — триггер догрузки (обёрнут в троттлинг).

* ```rangeChanged``` — обновление даты в шапке по первой видимой группе.

Дополнительно:

Возвращается "пустой элемент высотой 1px" при overscan вне диапазона — чтобы избежать предупреждения Zero-sized element.
